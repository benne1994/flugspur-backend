<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <title>3D Hybrid Satellit + Gel√§nde + Skipisten</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { margin: 0; overflow: hidden; }
    #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    #loc-btn {
      position: absolute; z-index: 10; left: 10px; top: 10px; padding: 8px 12px;
      background: #fff; border-radius: 8px; border: none; cursor: pointer; font-size: 1em;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
  </style>
  <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet" />
  <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
</head>
<body>
<button id="loc-btn">üìç Standort zeigen</button>
<div id="map"></div>
<script>
  const maptilerApiKey = 'r9nsDaWjLXRLFpq2ZVcC';

  // Begrenze den Kartenbereich f√ºr weniger Datenlast!
  const bounds = [
    [9.5, 49.8], // S√ºdwesten
    [10.9, 50.4] // Nordosten
  ];

  // Map initialisieren
  const map = new maplibregl.Map({
    container: 'map',
    style: `https://api.maptiler.com/maps/hybrid/style.json?key=${maptilerApiKey}`,
    center: [10.25, 50.125],
    zoom: 10,
    pitch: 45,
    bearing: 0,
    maxPitch: 60,
    antialias: true,
    maxBounds: bounds
  });

  map.on('load', () => {
    // --- Gel√§nde aktivieren ---
    map.addSource('terrain', {
      type: 'raster-dem',
      tiles: [`https://api.maptiler.com/tiles/terrain-rgb/{z}/{x}/{y}.png?key=${maptilerApiKey}`],
      tileSize: 512,
      maxzoom: 15
    });
    map.setTerrain({ source: 'terrain', exaggeration: 1.1 });

    // --- Skipisten-Overlay ---
    map.addSource('pisten', {
      type: 'raster',
      tiles: ['https://tiles.opensnowmap.org/pistes/{z}/{x}/{y}.png'],
      tileSize: 256,
      attribution: '¬© OpenSnowMap'
    });
    map.addLayer({
      id: 'pisten-layer',
      type: 'raster',
      source: 'pisten',
      minzoom: 0,
      maxzoom: 17
    });
  });

  // Standort-Button & Marker
  const btn = document.getElementById('loc-btn');
  let marker;
  btn.onclick = function() {
    if (!navigator.geolocation) {
      alert("Geolokalisierung wird nicht unterst√ºtzt.");
      return;
    }
    btn.textContent = "‚è≥ Standort wird gesucht...";
    navigator.geolocation.getCurrentPosition(pos => {
      const { longitude, latitude } = pos.coords;
      map.flyTo({ center: [longitude, latitude], zoom: 14, speed: 1.2 });
      if (marker) marker.setLngLat([longitude, latitude]);
      else marker = new maplibregl.Marker({ color: '#1976d2' })
        .setLngLat([longitude, latitude])
        .addTo(map);
      btn.textContent = "üìç Standort zeigen";
    }, err => {
      btn.textContent = "üìç Standort zeigen";
      alert("Standort nicht verf√ºgbar.");
    });
  };
</script>
</body>
</html>